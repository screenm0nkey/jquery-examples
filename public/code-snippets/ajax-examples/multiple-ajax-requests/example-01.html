<!DOCTYPE HTML><html lang="en-US">    <head>    	<title>Three ways to create a closure with AJAX</title>        <meta charset="UTF-8">        <script type="text/javascript" src="http://libraries/jquery-1.4.2.min.js"></script>        </script>        <style type="text/css">            input#main {                border: solid;            }                        input {                display: block;                margin-bottom: 2px;                width: 300px;            }        </style>        <title></title>    </head>    <body>        <form action="" id="">            <p>Type a number into the first input and then click out (lose focus)</p>            <input type="text" name="" id="main">            <input type="text" name="" id="01" class="update">            <input type="text" name="" id="02" class="update">            <input type="text" name="" id="03" class="update">            <input type="text" name="" id="04" class="update">            <input type="text" name="" id="05" class="update">            <input type="text" name="" id="06" class="update">            <input type="text" name="" id="07" class="update">            <input type="text" name="" id="08" class="update">            <input type="text" name="" id="09" class="update">            <input type="text" name="" id="10" class="update">            <input type="text" name="" id="11" class="update">            <input type="text" name="" id="12" class="update">            <input type="text" name="" id="13" class="update">            <input type="text" name="" id="14" class="update">            <input type="text" name="" id="15" class="update">            <input type="text" name="" id="16" class="update">            <input type="text" name="" id="17" class="update"></form>        <script type="text/javascript">                        (function($){                $.ajaxSetup({                    url: "ajax.php",                    type: "POST",                    cache: false                });                                                //using jQuery.proxy to keep the value of 'this' in the correct context                function updateFields01(elm){                    $('input.update').each(function(){                        var data = ({                            id: this.id,                            val: $(elm).val()                        });                        $.ajax({                            data: data,                            success: $.proxy(function(resp){                                // if you dont use $.proxy 'this' value will be the XHR object                                // see updateFields02 to see how we can do this ourselves                                $(this).val(resp);                            }, this)                        });                    });                }                                                //using closures to store the context of this                function updateFields02(elm){                    $('input.update').each(function(){                        var data = ({                            id: this.id,                            val: $(elm).val()                        });                        $.ajax({                            data: data,                            success: (function(el){                                return function(resp){                                    $(el).val(resp);                                };                            })(this)                        });                    });                }                                                //using closures to store the context of this                function updateFields03(elm){                    $('input.update').each(function(){                        var $this = $(this);                        var data = ({                            id: this.id,                            val: $(elm).val()                        });                        //console.log(data);                        $.ajax({                            data: data,                            success: function(resp){//this function becomes a closure storing the value to $this                                //console.log($this);                                $this.val(resp);                            }                        });                    });                }                                                                $(document).bind('AMOUNT_CHANGED', function(e, data){                    console.log(data.elm);                    updateFields02(data.elm);                });                                $('#main').focus(function(){                    $('input.update').val('');                });                                $('#main').blur(function(){                    $(document).trigger('AMOUNT_CHANGED', {                        elm: this                    });                });                            })(jQuery)        </script>    </body></html>